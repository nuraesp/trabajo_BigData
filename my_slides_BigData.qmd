---
title: "La evolución del aborto en las últimas décadas"  #- título
date: today              #- ISO8601 YYYY-MM-DD format 
date-format: short
format: 
  revealjs:
    scrollable: true
    slide-level: 2
    height: 900
    width: 1600
    toc: false
    center-title-slide: true
    title-slide-attributes: #- atributos para la slide de titulo
      data-background-color: "#562457"   #- color de R-ladies
    preview-links: auto  #- true: abre un iframe en lugar de abrir ventana
    link-external-newwindow: true
    transition: fade
    fontcolor: "#262d36"
    highlight-style: a11y
    code-line-numbers: true
    code-fold: true
    number-sections: false
    slide-number: c/t  
    incremental: false   
footer: |
  Slides hechas con [Quarto](https://quarto.org/) 
#theme: moon
---

# Librerías

```{r}
#| echo: true
#| message: false
#| warning: false

library(eurostat)
library(tidyverse)
library(sf)
library(magrittr)
library(dplyr)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(eurostat)
library(sf)
library(gt)
library(gtExtras)
library(rio)
library(readr)
library(forcats)
library(giscoR)
library(plotly)
library(magrittr)
```

# Ámbito geográfico del aborto 

## Evolución de los abortos en el Mundo
El gráfico representa la cantidad total de abortos (número absoluto de procedimientos) por región del mundo entre 1990 y 2017.
La escala vertical es logarítmica, lo que permite *comparar de manera visual la evolución proporcional de las cifras entre regiones con volúmenes muy distintos*, sin que las regiones con números más altos dominen la gráfica.


```{r}
#| echo: true
#| message: false
#| warning: false

ruta_global_abort_ind <- "./datasets/Global Abortion Incidence Dataset (1).csv"
global_abortion <- rio::import(ruta_global_abort_ind)

global_abort_mundial <- global_abortion %>% 
  select(yearstart, numberofabortions, region) %>%
  filter(!is.na(numberofabortions)) 


global_abort_mundial <- global_abort_mundial %>%
  mutate(region = case_when(
    region %in% c("Australia and New Zealand", "Oceania (excluding Australia and New Zealand)") ~ "Oceanía",
    region %in% c("Central and Southern Asia", "East and Southeastern Asia") ~ "Asia",
    TRUE ~ region
  ))

abort_region_mundial <- global_abort_mundial %>% 
  group_by(region, yearstart) %>% 
  summarise(numberofabortions = sum(numberofabortions, na.rm = TRUE))




p3 <- ggplot() +
  geom_line(data = abort_region_mundial, aes(yearstart, numberofabortions, group = region, color= region))+
  labs(
    title = "Abortos en el mundo entre 1990 y 2017", 
    x = "Año",
    y= "Abortos") +
  theme_minimal()

p4 <- p3 + scale_y_continuous(breaks = c(0, 100000, 1000000, 10000000), labels = scales::comma)

p4 <- p3 +
  scale_y_log10(
    labels = scales::comma)
```

```{r}
ggplotly(p4)

```

1.Asia Es la región con el mayor volumen absoluto de abortos durante todo el período (esto se infiere porque su línea está sistemáticamente por encima del resto en escala logarítmica). Muestra una tendencia a la baja continua desde 1990, especialmente marcada entre 1990 y 2000.Esta reducción puede estar relacionada con políticas de planificación familiar.

2.Europa y América del Norte Presenta un aumento hasta mediados de los 90, seguido de una reducción sostenida hasta estabilizarse a partir de 2010. El pico y posterior descenso pueden reflejar cambios legislativos, mayor acceso a anticoncepción de emergencia o evolución en los comportamientos reproductivos.


## Evolución de los abortos en Europa

El gráfico muestra la *evolución del número de abortos en distintos países europeos entre 1990 y 2017*. En la parte superior del gráfico aparecen, para cada año, los países con mayor número de abortos, mientras que en la parte inferior se representan aquellos con las cifras más bajas. Además, se incluye la evolución de España y de Italia.


```{r}
#| echo: true
#| message: false
#| warning: false



global_abort_europa <- global_abortion %>% 
  select(country, yearstart, numberofabortions, region) %>%
  filter(region == "Europe and Northern America") %>% 
  filter(!(country %in% c("Canada", "Ukraine", "United States of America", 
                        "Russian Federation", "Romania"))) %>% 
  filter(!is.na(numberofabortions)) 



p1 <- ggplot() +
  geom_line(data = global_abort_europa %>% group_by(yearstart) %>% slice_max(numberofabortions),
            aes(yearstart, numberofabortions), color = "black") +
  geom_line(data = global_abort_europa %>% group_by(yearstart) %>% slice_min(numberofabortions),
            aes(yearstart, numberofabortions), color = "black") +
  geom_line(data = global_abort_europa%>% filter(country %in% c("Spain", "Italy")),
            aes(x = yearstart, y = numberofabortions, color = country)) +
  labs(
    title = "Abortos en Europa entre 1990 y 2017", 
    x = "Año",
    y= "Abortos") +
  theme_minimal()


p2 <- p1 + 
  geom_label(data = global_abort_europa %>% group_by(yearstart) %>% slice_max(numberofabortions) %>%
      filter(yearstart == max(yearstart)), aes(yearstart, numberofabortions, label = country),
      show.legend = FALSE, size = 3) +
  geom_label(data = global_abort_europa %>% group_by(yearstart) %>% slice_min(numberofabortions) %>%
      filter(yearstart == max(yearstart)), aes(yearstart, numberofabortions, label = country),
      show.legend = FALSE, size = 3)
```

```{r}
p2
```

# Evolución del aborto en España

## Abortos legalmente inducidos en España entre 1985 y 2010 
El gráfico representa *la evolución del número de abortos en España entre 1985 y 2010*. A lo largo de todo el periodo se observa una tendencia general claramente ascendente, aunque con algunas variaciones según los años.

_La Ley Orgánica 9/1985, de 5 de julio, de reforma del artículo 417 bis del Código Penal."Ley supuestos"._
Bajo 3 supuestos:
1.Indicación Terapéutica.

2.Indicación Criminológica (Violación).

3.Indicación Eugenésica (Malformaciones Fetales).




```{r}
#| echo: true
#| message: false
#| warning: false
my_table <- "demo_fabort" 
df <- get_eurostat(my_table, time_format = 'raw', keepFlags = TRUE)
df_names <- names(df)
df <- label_eurostat(df, code = df_names, fix_duplicated = TRUE)
rm(df_names, my_table)

dist_geo <- df %>%
  distinct(geo)

count_geo <- df %>% 
  count(geo == "Spain")

df <- df %>% 
  mutate(TIME_PERIOD = as.numeric(TIME_PERIOD)) %>% 
  filter(TIME_PERIOD >= 1985)

df_spain_85_10 <- df %>%
  filter(
    geo == "Spain",
    between(TIME_PERIOD, 1985, 2010)
  ) 

aa<- df_spain_85_10 %>% filter(age == "Total")

aa<- df_spain_85_10 %>% filter(age == "Total")

g1 <- ggplot(aa,aes(x=TIME_PERIOD, y=values))+
  geom_line(color="plum",linewidth=1) + 
  geom_point(color="navyblue",size= 3)+
  labs(title = "Evolución del aborto en España  desde 1985 y 2010",
       x="Años",
       y="Abortos"
  )
```

```{r}

ggplotly(g1)
```

## Abortos después de introducirse la Ley de salud sexual y reporoductiva entre 2010 y 2023 
El gráfico muestra *la evolución del número de abortos en España entre 2010 y 2023* y refleja una trayectoria marcada por descensos, cambios de tendencia y un repunte final, que puede explicarse a partir del contexto legal, económico y social del periodo.

_Ley Orgánica 2/2010 (Ley de Plazos)_.
La Ley de 2010 sustituyó el modelo de supuestos por el modelo de plazos, convirtiendo la Interrupción Voluntaria del Embarazo (IVE) en un derecho y una prestación sanitaria.

El cambio fundamental fue el reconocimiento de la autonomía de la mujer:
1.Plazo Libre.14 semanas de gestación.

2.Plazo Limitado.hasta la semana 22.

3.Sin Límite.sin límite de semanas solo si el feto presenta anomalías incompatibles con la vida o una enfermedad extremadamente grave e incurable.



```{r}
#| echo: true
#| message: false
#| warning: false
df_spain_2010 <- df %>%
  filter(geo=="Spain",TIME_PERIOD>=2010)

#grafica
bb <-df_spain_2010 %>% filter(age == "Total") 

g2 <- ggplot(bb,aes(x=TIME_PERIOD, y=values))+
  geom_line(color="plum",linewidth=1) + 
  geom_point(color="navyblue",size= 2)+
  labs(title = "Evolución del aborto en España desde 2010 hasta 2023",
       x="Años",
       y="Abortos"
  )
```

```{r}

ggplotly(g2)
```

## Tasas de aborto en las Comunidades Autónomas
La tabla proporcionada resume el número de Interrupciones Voluntarias del Embarazo (IVE) registradas anualmente en España desde 1985 (año de la primera Ley de despenalización) hasta 2023.
La tabla desglosa, para cada año (TIME_PERIOD):

*N.º Abortos Mínimo (min_ev)*: El número de abortos más bajo registrado ese año (generalmente se refiere a la comunidad autónoma con la tasa o número más bajo).

*N.º Abortos Medio (mean_ev)*: El promedio de abortos registrados.

*N.º Abortos Máximo (max_ev)*: El número de abortos más alto registrado ese año (generalmente se refiere a la comunidad autónoma con la tasa o número más alto).


```{r}
#| echo: true
#| message: false
#| warning: false
df_spain_85_23 <- df %>%
  filter(
    geo == "Spain",
    between(TIME_PERIOD, 1985, 2023)
  )

df_summary <- df_spain_85_23 %>%
  group_by(TIME_PERIOD) %>%
  summarise(
    max_ev = max(values, na.rm = TRUE),   
    mean_ev = mean(values, na.rm = TRUE), 
    min_ev = min(values, na.rm = TRUE),   
    .groups = 'drop'
  )

tabla_gt1 <- df_summary %>%
  gt() %>%
  tab_header(
    title = "Resumen de Abortos en España (1985-2023)"
  ) %>%
  cols_label(
    TIME_PERIOD = "Año",
    min_ev = "N.ºAbortos Mínimo",
    mean_ev = "N.ºAbortos Medio",
    max_ev = "N.ºAbortos Máximo"
  ) %>%
  data_color(
    columns = c(max_ev, min_ev),  
    colors = scales::col_numeric(
      palette = c("gray", "plum"),
      domain = NULL
    )
  )
```

```{r}

DT::datatable(df_summary)
```

## Aborto en las Comunidades Autónomas
Las 5 CCAA con *mayores Tasas* de Aborto

Esta tabla resume las cinco Comunidades Autónomas (CC.AA.) que registraron la tasa de Interrupción Voluntaria del Embarazo (IVE) más alta en España en el año 2024.

```{r}
#| echo: true
#| message: false
#| warning: false
ruta_ccaa <- "./datasets/abortos_pccaa.csv"
datos_aborto_pccaa <- rio::import(ruta_ccaa)

datos_aborto_limpio <- datos_aborto_pccaa %>%
  rename_with(
      .fn = ~str_remove(., "X"), 
      .cols = starts_with("X20") 
    )
datos_aborto_limpio <- import(
  "./datasets/abortos_pccaa.csv", 
  setclass = "tibble",
  header = TRUE
)
datos_long <- datos_aborto_limpio %>%
    pivot_longer(
      cols = c(`2015`:`2024`), 
      names_to = "Year",         
      values_to = "Tasa"         
    )
datos_long$Year <- as.integer(datos_long$Year)
datos_long <- datos_long %>%
    mutate(Year = as.integer(Year))
datos_long <- datos_long %>%
  mutate(Tasa = trimws(Tasa))  
datos_long <- datos_long %>%
  mutate(Tasa = str_replace(Tasa, ",", "."))
datos_long <- datos_long %>%
  mutate(Tasa = as.numeric(Tasa))

top5_mas_abortos <- datos_long %>% 
    filter(Year == 2024) %>%
    slice_max(Tasa, n = 5) %>% 
  arrange(desc(Tasa))
```

```{r}


gt(top5_mas_abortos)
```

Las 5 CC.AA con menores Tasas de Aborto

Esta tabla resume las cinco Comunidades Autónomas (CC.AA.) que registraron la tasa de Interrupción Voluntaria del Embarazo (IVE) más baja en España en el año 2024.


```{r}
top5_menos_abortos <- datos_long %>% 
  filter(Year == 2024) %>%
  slice_min(Tasa, n = 5) %>% 
  arrange(desc(Tasa))
```

## CC.AA con Tasas de crecimiento significativas
La tabla muestra las 10 Comunidades Autónomas donde la tasa de abortos (por 1.000 habitantes) ha experimentado el mayor crecimiento absoluto entre el año 2015 (Tasa Inicial) y el año 2024 (Tasa Final).

1. El Indicador Clave: Crecimiento Total

El indicador más importante es Crecimiento Total, que se calcula como la diferencia simple entre la Tasa_Final_2024 y la Tasa_Inicial_2015.

Las CC.AA. están ordenadas de mayor a menor según este crecimiento, destacando aquellas donde la tasa ha aumentado más rápidamente en el periodo analizado.

2.Hallanzcos Clave

Identificación de Regiones Dinámicas: La tabla revela qué regiones están experimentando un cambio más significativo en sus tasas de aborto en la última década. Las CC.AA. que aparezcan aquí no son necesariamente las que tienen las tasas más altas en 2024 (como Madrid o Cataluña, que ya tenían tasas altas en 2015), sino aquellas donde la tasa ha crecido más agresivamente.

Posible Convergencia: Un crecimiento significativo en CC.AA. que históricamente tenían tasas bajas (debido a barreras de acceso, como la objeción de conciencia) podría indicar una mejora en el acceso a la prestación sanitaria a nivel local. Es decir, las mujeres están pudiendo acceder al aborto en su propia comunidad, en lugar de tener que viajar.
```{r}

gt(top5_menos_abortos)

datos_long <- datos_long %>%
  rename(Comunidad = `Comunidad Autónoma`)


crecimiento_abortos <- datos_long %>%
  filter(Comunidad  != "Total") %>%
  group_by(Comunidad ) %>% 
mutate(
crecimiento_anual = Tasa - lag(Tasa)) %>%
  summarise(
    Tasa_Inicial_2015 = first(Tasa), 
    Tasa_Final_2024 = last(Tasa),  
    Crecimiento_Total = Tasa_Final_2024 - Tasa_Inicial_2015,
    .groups = 'drop' 
  ) %>%
  slice_max(Crecimiento_Total, n = 10) %>%
  arrange(desc(Crecimiento_Total))

gt(crecimiento_abortos)
```



## Coropleta abortos en España en 2024

```{r}
#| echo: true
#| message: false
#| warning: false
mapa_ccaa <- gisco_get_nuts(
  country = "ES",         
  nuts_level = "2",       
  resolution = "3"
)

datos_2024_completo <- datos_long %>% 
  filter(Year == 2024, Comunidad != "Total") %>%
  mutate(
    CCAA_Limpia = case_when(
      Comunidad == "Asturias, Principado de" ~ "Principado de Asturias",
      Comunidad == "Baleares, Illes" ~ "Illes Balears",
      Comunidad == "C. Valenciana" ~ "Comunidad Valenciana",
      Comunidad == "Madrid, Comunidad de" ~ "Comunidad de Madrid",
      Comunidad == "Murcia, Región de" ~ "Región de Murcia",
      Comunidad == "Navarra, Comunidad Foral de" ~ "Comunidad Foral de Navarra",
      Comunidad == "Castilla - La Mancha" ~ "Castilla-La Mancha", 
      Comunidad == "Ceuta y Melilla, Ciudades Autónomas" ~ "Ciudad Autónoma de Ceuta",
      TRUE ~ Comunidad
    ),
    Tasa = trimws(Tasa),
    Tasa = str_replace(Tasa, ",", "."),
    Tasa = as.numeric(Tasa))

datos_2024_completo <- bind_rows(
  datos_2024_completo,
  datos_2024_completo %>%
    filter(CCAA_Limpia == "Ciudad Autónoma de Ceuta") %>%
    mutate(CCAA_Limpia = "Ciudad Autónoma de Melilla"))

datos_2024_completo <- datos_2024_completo %>%
  mutate(Categoria = cut(
    Tasa,
    breaks = c(-Inf, 9.0, 13.0, Inf),
    labels = c("Baja (Gris)", "Media (Violeta Claro)", "Alta (Violeta)"),
    right = FALSE))

mapa_final <- mapa_ccaa %>% 
  mutate(
    CCAA_Limpia = case_when(
      NAME_LATN %in% c("Ceuta", "Melilla") ~ "Ceuta y Melilla",
      TRUE ~ NAME_LATN
    )
  ) %>%
  left_join(datos_2024_completo, by = "CCAA_Limpia")

paleta_colores <- c(
  "Baja (Gris)" = "lightgrey", 
  "Media (Violeta Claro)" = "#E6E6FA", 
  "Alta (Violeta)" = "plum"
)


mapa_coropleta <- ggplot(mapa_final) +
  geom_sf(
    aes(fill = Categoria),
    color = "grey60", 
    linewidth = 0.2
  ) +
  scale_fill_manual(
    values = paleta_colores,
    name = "Tasa de Abortos (por 1.000) - 2024"
  ) +
  geom_sf_text(
    aes(label = CCAA_Limpia),
    size = 2,
    fontface = "bold",
    check_overlap = TRUE
  ) +
  labs(
    title = "Tasa de Abortos por CCAA (2024)",
    caption = "Clasificación: Baja < 9.0, Media < 13.0, Alta ≥ 13.0",
    fill = "Categoría de Tasa"
  ) +
  theme_minimal() +
  theme(
    axis.text = element_blank(),
    axis.title = element_blank(),
    panel.grid = element_blank(),
    legend.position = "left",
    legend.title = element_text(face = "bold.italic"),  
    legend.text = element_text(size = 12),
    plot.title = element_text(hjust = 0.5, face = "bold.italic", size = 16))
```


```{r}


mapa_coropleta

```


## CCAA con la Mayor y Menor Tasa de Abortos por Bloques de Años: Pre-COVID, COVID y Post-COVID

La tabla desglosa el análisis en tres bloques temporales: Pre-COVID (hasta 2019), COVID (2020-2021), y Post-COVID (a partir de 2022), identificando la Comunidad Autónoma (CCAA) con la tasa de Interrupción Voluntaria del Embarazo (IVE) más alta y más baja en cada periodo, junto con el valor exacto de esa tasa (expresada por 1.000 habitantes).
```{r}
#| echo: true
#| message: false
#| warning: false

datos_long <- datos_long %>%
  mutate(
    Bloque = case_when(
      Year <= 2019 ~ "Pre-COVID",
      Year %in% 2020:2021 ~ "COVID",
      Year >= 2022 ~ "Post-COVID"))

comparacion <- datos_long %>%
  group_by(Bloque) %>%
  summarise(
    Mayor_Tasa_CCAA = Comunidad[which.max(Tasa)],
    Mayor_Tasa = max(Tasa),
    Menor_Tasa_CCAA = Comunidad[which.min(Tasa)],
    Menor_Tasa = min(Tasa)
  ) %>%
  ungroup()

tabla_gt2 <- comparacion %>%
  gt() %>%
  tab_header(
    title = "CCAA con la Mayor y Menor Tasa de Abortos por Bloques de Años: Pre-COVID, COVID y Post-COVID" ) %>%
  cols_label(
    Bloque = "",
    Mayor_Tasa_CCAA = "CCAA Mayor Tasa",
    Mayor_Tasa = "Mayor Tasa",
    Menor_Tasa_CCAA = "CCAA Menor Tasa",
    Menor_Tasa = "Menor Tasa") %>%
  tab_source_note(
    source_note = "Las tasas están expresadas por 1.000 habitantes de cada CCAA.")  %>%
  tab_style(
  style = cell_text(size = px(10)),
  locations = cells_source_notes()
)
```

```{r}

tabla_gt2%>% gtExtras::gt_theme_pff()

 

```

# Leyes que regulan el aborto en el mundo 

## condiciones por aborto y despues de aborto
En *este gráfico vemos las principlaes bases legales por las cuales el aborto està permitido*, y nos muestra que la mayoría de los países autorizan el aborto cuando existe riesgo para la vida de la mujer, lo que refleja un amplio consenso internacional sobre esta condición. La autorización disminuye en los casos relacionados con la salud física y es aún más limitada cuando se trata de malformaciones fetales o de embarazos derivados de violación o incesto. Este patrón evidencia importantes diferencias legales y culturales entre los países y muestra que, fuera de las situaciones de riesgo vital, el acceso al aborto sigue siendo restrictivo en muchas partes del mundo.


```{r}
#| echo: true
#| message: false
#| warning: false
united_nations_ruta <-"./datasets/united_nations.csv"
df_unitednat <- rio::import(united_nations_ruta)

df_unitednat <- df_unitednat %>%
  select(V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13)

colnames(df_unitednat) <- c(
  "country",
  "country code",
  "life_risk",
  "physical_health",
  "rape_incest",
  "fetal_impairment",
  "medical_authorization",
  "judicial_consent_minors",
  "husband_consent",
  "criminal_charge",
  "post_abortion_law",
  "contradictory_legal_systems"
)

df_basi_legali_noNA <- df_unitednat %>%
  select(country, life_risk, physical_health, rape_incest, fetal_impairment) %>%
  mutate(
    across(
      c(life_risk, physical_health, rape_incest, fetal_impairment),
      ~ case_when(
        . == "Yes" ~ 1,
        . == "No"  ~ 0,
        TRUE ~ NA_real_))) %>%
  drop_na(life_risk, physical_health, rape_incest, fetal_impairment)

aa <- df_basi_legali_noNA %>%
  summarise(
    across(
      c(life_risk, physical_health, rape_incest, fetal_impairment),
      ~ sum(., na.rm = TRUE))
    )

paises_si <- df_basi_legali_noNA %>%
  filter(
    life_risk == 1,
    physical_health == 1,
    rape_incest == 1,
    fetal_impairment == 1
  )



baseleg_long <- df_unitednat %>%
  select(country, life_risk, physical_health, rape_incest, fetal_impairment) %>%
  pivot_longer(
    cols      =  -country,
    names_to  = "si_por_variable",
    values_to = "value") %>%
  filter(value ==  "Yes") %>%       
  count(si_por_variable, name = "n_yes")




p2 <- ggplot(baseleg_long, aes(x = si_por_variable, y = n_yes)) +
  geom_col(fill = "#2A9D8F") +  
  coord_flip() +
  labs(
    title = "Países que autorizan el aborto en todas las bases legales",
    x = "Variable",
    y = "Número de países"
  ) +
  theme_minimal()

```

```{r}

ggplotly(p2)

```


## Restricciones adicionales cuando el aborto es legal

El gráfico muestra que, *incluso cuando el aborto es legal*, muchos países imponen restricciones adicionales de tipo procedimental. La más frecuente es la autorización médica, presente en un elevado número de países, lo que limita la autonomía de la mujer en la toma de decisiones. En menor medida, algunos países exigen consentimiento judicial para las menores o incluso el consentimiento del marido, *restricciones que evidencian la persistencia de barreras legales* e institucionales al acceso efectivo al aborto.


```{r}
#| echo: true
#| message: false
#| warning: false
df_restriccion <- df_unitednat %>%
  select(country, medical_authorization, judicial_consent_minors, husband_consent) %>%
  mutate(
    across(
      c(medical_authorization, judicial_consent_minors, husband_consent),
      ~ case_when(
        . == "Yes" ~ 1,
        . == "No"  ~ 0,
        TRUE ~ NA_real_))) %>%
  drop_na(medical_authorization, judicial_consent_minors, husband_consent)

restrictions_long <- df_unitednat %>%
  select(country, medical_authorization, judicial_consent_minors, husband_consent) %>%
  pivot_longer(
    cols      = -country,
    names_to  = "restriction",
    values_to = "value"
  ) %>%
  filter(value == "Yes") %>%
  count(restriction, name = "n_yes")


k3 <- ggplot(restrictions_long, aes(x = restriction, y = n_yes)) +
  geom_col(fill = "#E63946") +
  coord_flip() +
  labs(
    title = "Países con restricciones procesales al aborto",
    x = "Tipo de restricción",
    y = "Número de países"
  )
```

```{r}

ggplotly(k3)

```


## Países donde el aborto está penalizado
¿En cuántos países está penalizado el aborto? ¿Cuántos países cuentan con leyes sobre atención postaborto? ¿Y cómo se relaciona esta información con las bases legales?

```{r}
df_crimen <- df_unitednat%>%
  select(country, life_risk, physical_health, rape_incest, fetal_impairment,
         criminal_charge, post_abortion_law, contradictory_legal_systems)


crimen_summary <- df_crimen %>%
  summarise(
    criminalized_yes      = sum(criminal_charge == "Yes", na.rm = TRUE),
    criminalized_no       = sum(criminal_charge == "No",  na.rm = TRUE),
    post_abortion_yes     = sum(post_abortion_law == "Yes", na.rm = TRUE),
    post_abortion_no      = sum(post_abortion_law == "No",  na.rm = TRUE),
    contradictions_yes    = sum(contradictory_legal_systems == "Yes", na.rm = TRUE),
    contradictions_no     = sum(contradictory_legal_systems == "No",  na.rm = TRUE)
  )


crimen_long <- tibble(
  categoria = c("criminal_charge", "criminal_charge",
                "post_abortion_law", "post_abortion_law",
                "contradictory_legal_systems", "contradictory_legal_systems"),
  value     = c("Yes", "No", "Yes", "No", "Yes", "No"),
  n         = c(crimen_summary$criminalized_yes,
                crimen_summary$criminalized_no,
                crimen_summary$post_abortion_yes,
                crimen_summary$post_abortion_no,
                crimen_summary$contradictions_yes,
                crimen_summary$contradictions_no)
)

p3 <- ggplot(crimen_long, aes(x = categoria, y = n, fill = value)) +
  geom_col(position = "dodge") +
  coord_flip() +
  labs(
    title = "Criminalización del aborto y leyes post-aborto",
    x = "Categoría",
    y = "Número de países",
    fill = "Valor"
  ) +
  theme_minimal()


```

```{r}
ggplotly(p3)



```
